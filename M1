import subprocess
import os

def get_installed_packages():
    """
    Retrieves a list of installed packages on the Android device.
    Returns:
    list: A list of package names.
    """
    try:
        # Run shell command to get the list of installed packages
        result = subprocess.run(['pm', 'list', 'packages'], stdout=subprocess.PIPE, text=True)
        packages = result.stdout.splitlines()
        # Extract package names from the output
        package_names = [pkg.split(':')[1] for pkg in packages]
        return package_names
    except Exception as e:
        print(f'Error retrieving package names: {e}')
        return []

def uninstall_all_apps():
    """
    Uninstalls all apps from the Android device.
    """
    packages = get_installed_packages()
    for pkg in packages:
        try:
            # Uninstall the app
            result = subprocess.run(['pm', 'uninstall', pkg], stdout=subprocess.PIPE, text=True)
            if result.returncode == 0:
                print(f'Uninstalled {pkg}.')
            else:
                print(f'Failed to uninstall {pkg}. Error: {result.stderr}')
        except Exception as e:
            print(f'Error uninstalling {pkg}: {e}')

# Main execution
if __name__ == "__main__":
    print("Starting uninstallation process...")
    uninstall_all_apps()
    print("Uninstallation process completed.")
